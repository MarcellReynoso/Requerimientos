@using NonFactors.Mvc.Grid
@model IQueryable<Requerimientos.Models.Kardex>

@{
    ViewData["Title"] = "Entradas y salidas";
    var controller = (string)ViewContext.RouteData.Values["controller"]!;
}

<h1 class="h1" style="font-size: 1.5rem;">@ViewData["Title"]</h1>

@* Seleccionar pestaña *@
@await Html.PartialAsync("_Tabs")

<div class="col-12">
    <a asp-controller="@controller" asp-action="Create" class="btn btn-primary">
        <i class="bi bi-plus-lg"></i>
        Nuevo registro
    </a>
</div>

<div class="tabla-ui pt-4">
    @(
        Html.Grid(Model)
        .Build(columns =>
        {
            columns.Add(k => k.Fecha).Titled("Fecha").Formatted("{0:dd/MM/yyyy}");

            columns.Add(k => k.Producto!.Codigo).Titled("Código");
            columns.Add(k => k.Producto!.Nombre).Titled("Producto");
            @* columns.Add(k => k.Producto!.Categoria!.Nombre).Titled("Categoría"); *@
            @* columns.Add(k => k.Pertenece!.Nombre).Titled("Almacén"); *@

            columns.Add(k => k.Cantidad).Titled("Cantidad").Formatted("{0:0}");
            columns.Add(k => k.Descripcion).Titled("Descripción");

            columns.Add(k => k.Proviene).Titled("Proviene");

            columns.Add(k => k.QuienEntrega!.Nombre).Titled("Quién entrega");
            columns.Add(k => k.QuienRecibe!.Nombre).Titled("Quién recibe");

            columns.Add(k => k.PrecioUnitario).Titled("Prec. unitario").Formatted("S/ {0:N2}");
            columns.Add(k => k.PrecioVenta).Titled("Prec. venta").Formatted("S/ {0:N2}");

            columns.Add(k => k.DocumentoIngreso).Titled("Doc. ingreso");
            columns.Add(k => k.DocumentoSalida).Titled("Doc. salida");

            columns.Add(k =>
            $"<a class='text-info me-2' href='{Url.Action("Details", controller, new { id = k.Id })}' title='Detalles'><i class='bi bi-eye-fill'></i></a>" +
            $"<a class='text-warning me-2' href='{Url.Action("Edit", controller, new { id = k.Id })}' title='Editar'><i class='bi bi-pencil-fill'></i></a>" +
            $"<a class='text-danger' href='{Url.Action("Delete", controller, new { id = k.Id })}' title='Eliminar' onclick=\"return confirm('¿Eliminar este registro de Kardex?');\"><i class='bi bi-trash3-fill'></i></a>"
            ).Titled("").Encoded(false);
        })
        .Empty("No hay datos en esta tabla.")
        .Filterable()
        .Sortable()
        @* .UsingFooter("_GridFooter") *@
        .Pageable(p =>
        {
            p.PageSizes = new Dictionary<int, string> { { 0, "Todos" }, { 5, "5" }, { 10, "10" }, { 15, "15" }, { 20, "20" } };
            p.ShowPageSizes = true;
            p.RowsPerPage = 15;
        })
        )
</div>
